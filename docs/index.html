<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extract Climate Data From a Local NETCDF File ‚Ä¢ climateExtract</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Extract Climate Data From a Local NETCDF File">
<meta property="og:description" content="A toolbox to ease the extraction and manipulaiton of daily gridded climate data from a NETCDF object available from the European Climate Assessement &amp; Datasets (ECAD) for specific time period, compute summarized values and link them to set of spatial points.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">climateExtract</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.22.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="climateextract" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#climateextract" class="anchor"></a>climateExtract</h1></div>

<p><img style="float: right;" src="climateExtractHex.png" width="200" hspace="20"></p>
<p>R functions to extract climate data from local NETCDF file that you can download from the ECAD at <a href="https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles">Copernicus Climate</a></p>
<p>Package URL: <a href="https://retoschmucki.github.io/climateExtract">https://retoschmucki.github.io/climateExtract/</a></p>
<p><strong>NEWS (06/02/2021):</strong></p>
<ul>
<li>Updated to E-OBS v22 (December 2020)</li>
<li>Added option for accessing smaller chunk (15 years) with the argument <code>sml_chunk</code> in the function <code><a href="reference/extract_nc_value.html">extract_nc_value()</a></code>
</li>
<li>Changing argument names to underscore format to avoid possible confusion with generic method functions</li>
</ul>
<p><strong>NEWS (11/10/2020):</strong></p>
<ul>
<li>Updated to allow manual entry of nc path as an argument in <code><a href="reference/extract_nc_value.html">extract_nc_value()</a></code>, using the argument <code>file_path= "YOUR/PATH"</code>: contribution <a href="https://github.com/romainlorrilliere">Romain Lorrilliere</a>
</li>
<li>ECAD URL has moved, this is now functional again -sorry- <span class="emoji" data-emoji="cat">üê±</span>
</li>
</ul>
<div id="suggested-citation-for-the-climateextract-package" class="section level4">
<h4 class="hasAnchor">
<a href="#suggested-citation-for-the-climateextract-package" class="anchor"></a>Suggested citation for the climateExtract package</h4>
<p>Schmucki R. (2021) climateExtract: Extract and manipulate daily gridded observational dataset of European climate (E-OBS) provided by ECA&amp;D. R package version 1.22.0. <a href="https://github.com/RetoSchmucki/climateExtract" class="uri">https://github.com/RetoSchmucki/climateExtract</a></p>
</div>
<div id="installation" class="section level4">
<h4 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h4>
<p>You will need the package <code>devtools</code> (or <code>remotes</code>) and then use the function install_github()</p>
<pre><code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("devtools")
devtools::install_github("RetoSchmucki/climateExtract")</a></code></pre>
<p>This package depends on the <code>ncdf4</code> package. For <em>Linux</em> or <em>MacOS</em> users, the <code>ncdf4</code> can be installed directly from CRAN. For <em>Windows</em> users, if CRAN installation does not work, refer to the instructions available at <a href="http://cirrus.ucsd.edu/~pierce/ncdf/" class="uri">http://cirrus.ucsd.edu/~pierce/ncdf/</a> and install the <code>ncdf4</code> package manually from the appropriate <code>.zip</code> file, note the latest version (v1.17) is available on CRAN <a href="https://cran.r-project.org/web/packages/ncdf4/index.html" class="uri">https://cran.r-project.org/web/packages/ncdf4/index.html</a>.</p>
<p><strong>Windows users</strong> also need to install a tool to unzip the file from your command prompt. To make it easy and cross-platform, I rely on Rtools that is available for download from [here] (<a href="https://cran.r-project.org/bin/windows/Rtools/index.html" class="uri">https://cran.r-project.org/bin/windows/Rtools/index.html</a>). The Rtools installer should install it in ‚ÄúC:\Rtools\bin‚Äù. This need to be added to your PATH environment variable (if you forgot how to do this, follow the <a href="http://www.computerhope.com/issues/ch000549.htm">instruction here</a>). Once you installed and set the PATH in your environment variable, relaunch your R instance and test it with this function system(‚Äúgzip -h‚Äù). This should print the help documentation for the gzip function. Now with Rtools on board, you are ready to go and extract some climate data! Well, almost as you might encounter some issues related to R‚Äôs memory limit under Windows. I am slowly working on this issue (among others) by revisiting and restructuring the source code. Anyway, there is a workaround memory issue under Windows, and this is by extracting a smaller chunk of data at the time (see point no.5 below).</p>
<p><strong>Before extracting any data, please read carefully the description of the datasets and the different grid size available (eg. 0.25 deg. regular grid, ‚ÄúTG‚Äù average temperature).</strong> <strong>Note</strong> that shorter time-series are also available <a href="https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles">Copernicus Climate</a></p>
<p>** Data available at 0.1 deg regular grid are ca. 5GB and can be challenging to handle with this framework. However, 0.25deg seem to be working.**</p>
<p><strong>You could download the high-resolution grid and subset the area of interest to build a manageable dataset, I am working on some alternatives, but this will depend on my inspiration and time.</strong></p>
</div>
<div id="example" class="section level4">
<h4 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h4>
<p>You can get your climate data from the web repository <a href="https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles" class="uri">https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles</a> and decompress the data to extract the <code>.nc</code> file.</p>
<p>Or you can use the function <code><a href="reference/extract_nc_value.html">extract_nc_value()</a></code> to download the Data directly by setting the parameter local_file to FALSE and adding the details of the Data you want to be extracted.</p>
<p><strong>1.</strong> To extract climate values for a specific time period, use the function <code><a href="reference/extract_nc_value.html">extract_nc_value()</a></code>. By default, this function will open an interactive window asking you to select a local <code>.nc</code> file from which you want the data to extract; you need to specify the first and the last years of the period you are interested.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://retoschmucki.github.io/climateExtract">climateExtract</a></span><span class="op">)</span>
<span class="va">climate_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/extract_nc_value.html">extract_nc_value</a></span><span class="op">(</span>first_year <span class="op">=</span> <span class="fl">2012</span>,
                                 last_year <span class="op">=</span> <span class="fl">2015</span><span class="op">)</span></code></pre></div>
<p><strong>2.</strong> If you don‚Äôt have a local .nc file, you can ask the function to download the desired Data directly from the web repository. To reduce the size of the data to download and manipulate, you can select a specific period available as ‚Äúchunks‚Äù of 15 years (see help(etract_nc_value)).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">climate_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/extract_nc_value.html">extract_nc_value</a></span><span class="op">(</span>first_year <span class="op">=</span> <span class="fl">2012</span>, 
                                 last_year <span class="op">=</span> <span class="fl">2015</span>,
                                 local_file <span class="op">=</span> <span class="cn">FALSE</span>,
                                 file_path <span class="op">=</span> <span class="cn">NULL</span>, 
                                 sml_chunk <span class="op">=</span> <span class="cn">NULL</span>,
                                 clim_variable <span class="op">=</span> <span class="st">'precipitation'</span>,
                                 statistic <span class="op">=</span> <span class="st">"mean"</span>,
                                 grid_size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></code></pre></div>
<p><em>where clim_variable set to:</em></p>
<ul>
<li>‚Äúmean temp‚Äù extract the daily mean temperature</li>
<li>‚Äúmim temp‚Äù extract the daily minimum temperature</li>
<li>"max temp extract the daily maximum temperature</li>
<li>‚Äúprecipitation‚Äù extract the daily precipitation</li>
</ul>
<p><em>where grid_size set to:</em></p>
<ul>
<li>0.25 extract a grid with a 0.25-degree resolution</li>
<li>0.10 extract a grid with a 0.10-degree resolution</li>
</ul>
<p><strong>3.</strong> To compute summary value of the daily values, use the function <code><a href="reference/temporal_mean.html">temporal_mean()</a></code> for temperature or <code><a href="reference/temporal_sum.html">temporal_sum()</a></code> for precipitation . This function computes the mean for a specified period, monthly or annual or for a specified window, computing a rolling average over a specific number of days. <strong>NOTE</strong> This function use the data extracted with the function <code>extract_nc_value</code>.</p>
<pre><code>annual_mean &lt;- temporal_mean(climate_data,"annual")
monthly_sum &lt;- temporal_sum(climate_data,"monthly")</code></pre>
<p><strong>4.</strong> To extract the weather data for a set of specific locations (points), use the function <code><a href="reference/point_grid_extract.html">point_grid_extract()</a></code>. With this function, you can extract either the original or the summary values corresponding to the points, depending on the data object provided in the first argument. The second argument is a <code>data.frame</code> with the coordinates of the points in a degree decimal format and using the EPSG projection 4326 - <strong>wgs 84</strong></p>
<pre><code>point_coord &lt;- data.frame(site_id=c("site1","site2","site3","site4","site5"), longitude=c(28.620000,6.401499,4.359062,-3.579906,-2.590392), latitude=c(61.29000,52.73953,52.06530,50.43031,52.02951))

point.ann_mean &lt;- point_grid_extract(annual_mean,point_coord)
point.month_sum &lt;- point_grid_extract(monthly_sum,point_coord)</code></pre>
<p><strong>5.</strong> To extract long series, one chunk at a time (A quick and dirty workaround memory limit under Windows).</p>
<pre><code><a href="https://retoschmucki.github.io/climateExtract"># This is a workaround when facing memory issues under Windows while extracting a long series on a computer
# with limited RAM.

library(climateExtract)

climate_data &lt;- extract_nc_value(1950, 1960, local_file=FALSE, clim_variable='mean temp', grid_size=0.25)
point_coord &lt;- data.frame(site_id = c("site1"), longitude = c(-1.3177988), latitude = c(51.7503954))

annual_mean &lt;- temporal_mean(climate_data, "annual")
point.ann_mean &lt;- point_grid_extract(annual_mean, point_coord)

climate_data &lt;- extract_nc_value(1961, 1970)
annual_mean &lt;- temporal_mean(climate_data, "annual")
point.ann_mean &lt;- rbind(point.ann_mean, point_grid_extract(annual_mean, point_coord))

climate_data &lt;- extract_nc_value(1971,1980)
annual_mean &lt;- temporal_mean(climate_data,"annual")
point.ann_mean &lt;- rbind(point.ann_mean,point_grid_extract(annual_mean,point_coord))

climate_data &lt;- extract_nc_value(1981, 1990)
annual_mean &lt;- temporal_mean(climate_data, "annual")
point.ann_mean &lt;- rbind(point.ann_mean, point_grid_extract(annual_mean, point_coord))

climate_data &lt;- extract_nc_value(1991, 2000)
annual_mean &lt;- temporal_mean(climate_data, "annual")
point.ann_mean &lt;- rbind(point.ann_mean, point_grid_extract(annual_mean, point_coord))

climate_data &lt;- extract_nc_value(2001, 2012)
annual_mean &lt;- temporal_mean(climate_data, "annual")
point.ann_mean &lt;- rbind(point.ann_mean, point_grid_extract(annual_mean, point_coord))


names(point.ann_mean) &lt;- c("year", "mean_temp") # I really need to fix this

plot(point.ann_mean$year, point.ann_mean$mean_temp, type = 'l')
abline(h = mean(point.ann_mean$mean_temp), col = 'red')</a></code></pre>
<p><strong>6.</strong> If you want a raster of the mean temperature across Europe for a specific year (e.g.¬†1988).</p>
<pre><code># get a raster

library(climateExtract)
library(raster)
climate_data &lt;- extract_nc_value(1988, 1988, local_file = FALSE, clim_variable = 'mean temp', grid_size = 0.25)

# compute the annual mean temperature
annual_mean &lt;- temporal_mean(climate_data, "annual")

# get a XY data.frame for the 0.25deg grid
grid.e &lt;- expand.grid(annual_mean$longitude, annual_mean$latitude)

# extract the value for 1988 in one vector
y1988 &lt;- as.vector(annual_mean$value_array[ , , 1])

# build a XYZ object
xyz_value &lt;- cbind(grid.e, y1988)

# build a raster from the XYZ object with the library raster
r &lt;- rasterFromXYZ(xyz_value, crs = CRS("+init=epsg:4326"))
names(r) &lt;- annual_mean$date_extract[1]

# voila!
plot(r, main("Mean temperature in 1988")

# you could use the stack() function to build a raster stack (multiple bands) with multiple years, months or days
</code></pre>
<p><em>This is a work in progress that is good for some tasks, but this comes with no guarantee. Suggestions and contributions for improvement are welcome.</em></p>
</div>
<div id="to-do" class="section level4">
<h4 class="hasAnchor">
<a href="#to-do" class="anchor"></a>TO DO</h4>
<ul class="task-list">
<li>
<input type="checkbox" disabled checked>
implement data.table approach to compute summary statistics to speed up the computation</li>
<li>
<input type="checkbox" disabled>
optimize the script to avoid (limit) memory issues under Windows</li>
<li>
<input type="checkbox" disabled>
update and improve documentation</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing climateExtract</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Reto Schmucki <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3064-7553" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/RetoSchmucki/climateExtract"><img src="https://travis-ci.org/RetoSchmucki/climateExtract.png?branch=master" alt="Build Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Reto Schmucki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
