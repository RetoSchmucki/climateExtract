<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extract Climate Data From a Local or online NETCDF   • climateExtract</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Extract Climate Data From a Local or online NETCDF  ">
<meta property="og:description" content="A toolbox to ease the extraction and manipulaton of daily gridded climate data from a NETCDF object available from the European Climate Assessement &amp; Datasets (ECAD) for specific time period, compute summarized values and link them to set of spatial points.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">climateExtract</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.23.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/old_version_example.html">Example for older versions of ClimateExtract</a>
    </li>
    <li>
      <a href="articles/old_installation_note.html">Installation note for older systems</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RetoSchmucki/climateExtract/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="climateextract-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#climateextract-" class="anchor"></a>climateExtract <img src="reference/figures/logo.png" align="right" alt="" width="120">
</h1></div>
<!-- badges: start -->

<p>R functions to extract climate data from local NETCDF file that you can download from the ECAD at <a href="https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles">Copernicus Climate</a></p>
<p>Package URL: <a href="https://retoschmucki.github.io/climateExtract">https://retoschmucki.github.io/climateExtract/</a></p>
<p><strong>NEWS (07/04/2021):</strong></p>
<ul>
<li>Updated to E-OBS v23.1 (March 2021)</li>
<li>Optimized several functions</li>
<li>Added option to write data to a raster brick</li>
<li>Better used of memory</li>
<li>Extract data within a bounding box of polygons or points</li>
<li>Option to manually select the E-OBS version</li>
</ul>
<p><strong>NEWS (06/02/2021):</strong></p>
<ul>
<li>Updated to E-OBS v22 (December 2020)</li>
<li>Added option for accessing smaller chunk (15 years) with the argument <code>sml_chunk</code> in the function <code><a href="reference/extract_nc_value.html">extract_nc_value()</a></code>
</li>
<li>Changing argument names to underscore format to avoid possible confusion with generic method functions</li>
</ul>
<div id="suggested-citation-for-the-climateextract-package" class="section level4">
<h4 class="hasAnchor">
<a href="#suggested-citation-for-the-climateextract-package" class="anchor"></a>Suggested citation for the climateExtract package</h4>
<p>Schmucki R. (2021) climateExtract: Extract and manipulate daily gridded observational dataset of European climate (E-OBS) provided by ECA&amp;D. R package version 1.23.0. <a href="https://github.com/RetoSchmucki/climateExtract" class="uri">https://github.com/RetoSchmucki/climateExtract</a></p>
</div>
<div id="installation" class="section level4">
<h4 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h4>
<p>You will need the package <code>devtools</code> (or <code>remotes</code>) and then use the function install_github()</p>
<pre><code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("devtools")
devtools::install_github("RetoSchmucki/climateExtract")</a></code></pre>
<p>climateExtract depends on <code>ncdf4</code> <code>data.table</code> <code>sf</code> <code>stars</code> <code>raster</code> <code>terra</code> <code>zoo</code> <code>methods</code></p>
</div>
<div id="usage" class="section level4">
<h4 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h4>
<p>Load the library and check the version of the ECAD database</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://retoschmucki.github.io/climateExtract">climateExtract</a></span><span class="op">)</span> 
<span class="va">ecad_version</span></code></pre></div>
<p>To limit the size of the object, we can limit the extract to a specific region of the data set. Here we will extract climate data for France and for 25 points (random) within the country. We use the package raster to retrieve a spatial object of France’s country borders and sf to generate 25 random point within the country. Because points are generated through a random number process, we set.seed for repeatability.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42876</span><span class="op">)</span>
<span class="va">fr_border</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span><span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"FRA"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">sf_point</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html">st_sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fr_border</span>, size <span class="op">=</span> <span class="fl">25</span>, type <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Use the function <code>extract_nc_value</code> to retrieve the climate data from the online E-OBS server and crop the data within the extent of the spatial object provided. We specify the first and last year of interest, use <code>sml_chunk</code> to reduce the size of the file to download, see details help(extract_nc_value). The argument <code>write_raster=TRUE</code> will write a raster brick object in your directory of the region defined by the spatial extent. The argument <code>return_data = TRUE</code> returns an R object (a list) with the climate values stored in a numeric array.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">climate_data</span> <span class="op">=</span> <span class="fu"><a href="reference/extract_nc_value.html">extract_nc_value</a></span><span class="op">(</span>first_year <span class="op">=</span> <span class="fl">2012</span>, 
                                last_year <span class="op">=</span> <span class="fl">2015</span>,
                                local_file <span class="op">=</span> <span class="cn">FALSE</span>,
                                file_path <span class="op">=</span> <span class="cn">NULL</span>,
                                sml_chunk <span class="op">=</span> <span class="st">"2011-2020"</span>,
                                spatial_extent <span class="op">=</span> <span class="va">fr_border</span>,
                                clim_variable <span class="op">=</span> <span class="st">"mean temp"</span>,
                                statistic <span class="op">=</span> <span class="st">"mean"</span>,
                                grid_size <span class="op">=</span> <span class="fl">0.25</span>,
                                ecad_v <span class="op">=</span> <span class="cn">NULL</span>,
                                write_raster <span class="op">=</span> <span class="cn">TRUE</span>,
                                out <span class="op">=</span> <span class="st">"raster_mean_temp.grd"</span>,
                                return_data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>From here, we can use the raster package to connect to the raster brick created. If this object is too big for being stored in Memory, raster will set pointer to the raster file on the disk.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rbk</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"raster_mean_temp.grd"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">climate_data</span><span class="op">)</span>, <span class="st">"MB"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">rbk</span><span class="op">)</span>, <span class="st">"MB"</span><span class="op">)</span></code></pre></div>
<p>We can now aggregate the data over time, “annual”, “monthly” or using a rolling “window”. Here we show a monthly average, using the function <code>mean</code>, this could be set to <code>sum</code>, <code>sd</code> or many others.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># monthly mean</span>
<span class="va">monthly_avg_temp_R</span> <span class="op">=</span> <span class="fu"><a href="reference/temporal_aggregate.html">temporal_aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbk</span>,
                                        agg_function <span class="op">=</span> <span class="st">"mean"</span>,
                                        variable_name <span class="op">=</span> <span class="st">"average temp"</span>,
                                        time_step <span class="op">=</span> <span class="st">"monthly"</span><span class="op">)</span>
<span class="co"># annual mean</span>
<span class="va">annual_avg_temp_R</span> <span class="op">=</span> <span class="fu"><a href="reference/temporal_aggregate.html">temporal_aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbk</span>,
                                       agg_function <span class="op">=</span> <span class="st">"mean"</span>,
                                       variable_name <span class="op">=</span> <span class="st">"average temp"</span>,
                                       time_step <span class="op">=</span> <span class="st">"annual"</span><span class="op">)</span>
<span class="co"># 7-day rolling mean</span>
<span class="va">window_7d_avg_temp_R</span> <span class="op">=</span> <span class="fu"><a href="reference/temporal_aggregate.html">temporal_aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbk</span>,
                                          agg_function <span class="op">=</span> <span class="st">"mean"</span>,
                                          variable_name <span class="op">=</span> <span class="st">"average temp"</span>,
                                          time_step <span class="op">=</span> <span class="st">"window"</span>,
                                          win_length <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<blockquote>
<p>Note: the <code>x</code> object can be the climate_data object that resulted from the <code><a href="reference/extract_nc_value.html">extract_nc_value()</a></code> function.</p>
</blockquote>
<p>Aggregation can also be computed for specific points, if a spatial point object is provided as <code>y</code> argument (e.g. <code>y = sf_point</code>). This will return a data.table object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># annual mean per point</span>
<span class="va">annual_avg_temp_pnts</span> <span class="op">=</span> <span class="fu"><a href="reference/temporal_aggregate.html">temporal_aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbk</span>,
                                          y <span class="op">=</span> <span class="va">sf_point</span>,
                                          agg_function <span class="op">=</span> <span class="st">"mean"</span>,
                                          variable_name <span class="op">=</span> <span class="st">"average temp"</span>,
                                          time_step <span class="op">=</span> <span class="st">"annual"</span><span class="op">)</span></code></pre></div>
<blockquote>
<p>Note: Because the point that is referring to <code>site_1</code> falls outside of the raster cell having a value, along the coast, the function extract the value of the nearest cell with a value. The distance_from_pnt indicate how far the centroid of this cell is from the point, when the point falls in a cell, the distance_from_pnt is NA.</p>
</blockquote>
<p>We can produce a map of the averaged layer calculated. For example the average temperature for Sept 2012, <code>"2012.09"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">monthly_avg_temp_R</span><span class="op">[[</span><span class="st">"2012.09"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>You can plot the points on this same map, with a circle around the point 1, falling in the see near the coast of Corse (bottom right corner). This is only true if the seed was set to <code><a href="https://rdrr.io/r/base/Random.html">set.seed(42876)</a></code> for the random sampling.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">monthly_avg_temp_R</span><span class="op">[[</span><span class="st">"2012.09"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sf_point</span>, col <span class="op">=</span> <span class="st">'magenta'</span>, pch <span class="op">=</span> <span class="fl">17</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sf_point</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, col <span class="op">=</span> <span class="st">'blue'</span>, border<span class="op">=</span> <span class="fl">1.5</span>, cex<span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="citation-and-term-of-use-from-ecad-data" class="section level3">
<h3 class="hasAnchor">
<a href="#citation-and-term-of-use-from-ecad-data" class="anchor"></a>Citation and term of use from ECAD Data</h3>
<p>See citation and ECA&amp;D/E-OBS data policy at <a href="https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles">https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles</a> You can register as an E-OBS user at <a href="https://surfobs.climate.copernicus.eu/dataaccess/registration.php">https://surfobs.climate.copernicus.eu/dataaccess/registration.php</a></p>
<p><strong>Before extracting any data, please read carefully the description of the datasets and the different grid size available (eg. 0.25 deg. regular grid, “TG” average temperature).</strong> <strong>Note</strong> that shorter time-series are also available <a href="https://surfobs.climate.copernicus.eu/dataaccess/access_eobs.php#datafiles">Copernicus Climate</a></p>
<p>** Data available at 0.1 deg regular grid are ca. 5GB and can be challenging to handle when extracting the entire continent, consider using specific areas defined by spatial object (e.g. set of points or polygons).**</p>
<p><strong>You can download the high-resolution grid and subset the area of interest to build a manageable dataset as demonstrated above.</strong></p>
<p><em>This is a work in progress that is good for some tasks, but this comes with no guarantee. Suggestions and contributions for improvement are welcome.</em></p>
<p><strong>Raise issues <span class="emoji" data-emoji="raised_hand">✋</span>: </strong> <a href="https://github.com/RetoSchmucki/climateExtract/issues">https://github.com/RetoSchmucki/climateExtract/issues</a></p>
<div id="to-do" class="section level4">
<h4 class="hasAnchor">
<a href="#to-do" class="anchor"></a>TO DO</h4>
<ul class="task-list">
<li>
<input type="checkbox" disabled>
update and improve documentation</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/RetoSchmucki/climateExtract/">https://​github.com/​RetoSchmucki/​climateExtract/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/RetoSchmucki/climateExtract/issues">https://​github.com/​RetoSchmucki/​climateExtract/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing climateExtract</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Reto Schmucki <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3064-7553" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/RetoSchmucki/climateExtract"><img src="https://travis-ci.com/RetoSchmucki/climateExtract.png?branch=master" alt="Build Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Reto Schmucki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
